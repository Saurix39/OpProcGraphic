{% extends 'layout.html'%}

{% block title %}
Método Dos Fases
{% endblock %}

{% block header %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modelo.css')}}">
<script type="text/javascript" src="{{ url_for('static', filename='js/modelo.js')}}"></script>
{% endblock %}

{% block body %}
<div class="bg-top">
    <h1 class="mb-5 page-title">Método Dos Fases</h1>
</div>
<div class="container-info">
    <div class="btn-left btn-styles">
        <i class="fas fa-arrow-left"></i>
    </div>
    <div class="btn-right btn-styles">
        <i class="fas fa-arrow-right"></i>
    </div>
    <div class="slider">
        <div class="info-page flex">
            <h3 class="form-title">Estandarización</h3>
            <div class="tables">
                <table class="modelo-table">
                    <tbody>
                        <tr>
                            <th>Función objetivo ({{ MaxMin }})</th>
                            <td>{{ fo | safe }}</td>
                        </tr>
    
                        {% for res in restricciones %}
    
                            <tr>
                                <th>Restriccion No. {{ loop.index }}</th>
                                <td>{{ res | safe }}</td>
                            </tr>
                        {% endfor %}
                        <tr>
                            <th>No negatividad</th>
                            <td> X<sub>1</sub>, X<sub>2</sub> &ge; 0</td>
                        </tr>
                    </tbody>
                </table>
                <table class="modelo-table">
                    <tbody>
                        <tr>
                            <th>Función objetivo ({{ MaxMin }})</th>
                            <td>{{ objMat1[0].estandarizacionFO() }}</td>
                        </tr>
    
                        {% for res in new_restric %}
    
                            <tr>
                                <th>Restriccion No. {{ loop.index }}</th>
                                <td>{{ res | safe }}</td>
                            </tr>
                        {% endfor %}
                        <tr>
                            <th>No negatividad</th>
                            <td> X<sub>1</sub>, X<sub>2</sub> &ge; 0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="info-page selected">
            <h3 class="form-title">Fase 1</h3>
            <div class="carrousel">
                <div class="carrousel__container">
                    {% for mat in objMat1 %}
                    <table class="modelo-table table-fase1">
                        <tbody>
                            <tr id="tr-editable">
                                <th>Cj</th>
                                {% for i in mat.getFilaCj() %}
                                    <th>{{i}}</th>
                                {% endfor %}
                                <th colspan="2">Tabla {{ loop.index }}</th>
                            </tr>
                            <tr>
                                <th>Cx</th>
                                {% for i in mat.getHeader() %}
                                    {%if loop.index != mat.getHeader()|length%}
                                        <th>{{i}}</th>
                                    {%endif%}
                                {% endfor %}
                                <th> Xb </th>
                                <th>Bi</th>
                            </tr>
                            {% for fila in mat.getMatriz() %}
                                <tr class="{{'pivote' if loop.index-1 == mat.getRenglonPivote()}}">
                                    {% set datosFila = mat.datosDeFilaMatriz(loop.index-1) %}
                                    {% for valor in datosFila %}
                                        <th class="{{'pivote' if loop.index-2 == mat.getColumnaPivote()}}">{{valor}}</th>
                                    {% endfor %}
                                </tr>
                            {%endfor%}
                            <tr>
                                <th>Zj-Cj</th>
                                {% for valor in mat.getZjCj() %}
                                    <th>{{valor}}</th>
                                {% endfor %}
                                <th colspan="2">
                                    Z={{ mat.getZ() }}
                                </th>
                            </tr>
                        </tbody>
                    </table>
                    {% endfor %}
                </div>
                <ul class="puntos">
                    {% for mat in objMat1 %}
                        <li class="punto"></li>
                    {%endfor%}    
                </ul>
            </div>
        </div>
        <div class="info-page selected">
            <h3 class="form-title">Fase 2</h3>
            <!-- <div class="carrousel">
                <div class="carrousel__container-fase2">
                    {% for mat in objMat1 %}
                    <table class="modelo-table table-fase2">
                        <tbody>
                            <tr id="tr-editable">
                                <th>Cj</th>
                                {% for i in mat.getFilaCj() %}
                                    <th>{{i}}</th>
                                {% endfor %}
                                <th colspan="2">Tabla {{ loop.index }}</th>
                            </tr>
                            <tr>
                                <th>Cx</th>
                                {% for i in mat.getHeader() %}
                                    {%if loop.index != mat.getHeader()|length%}
                                        <th>{{i}}</th>
                                    {%endif%}
                                {% endfor %}
                                <th> Xb </th>
                                <th>Bi</th>
                            </tr>
                            {% for fila in mat.getMatriz() %}
                                <tr class="{{'pivote' if loop.index-1 == mat.getRenglonPivote()}}">
                                    {% set datosFila = mat.datosDeFilaMatriz(loop.index-1) %}
                                    {% for valor in datosFila %}
                                        <th class="{{'pivote' if loop.index-2 == mat.getColumnaPivote()}}">{{valor}}</th>
                                    {% endfor %}
                                </tr>
                            {%endfor%}
                            <tr>
                                <th>Zj-Cj</th>
                                {% for valor in mat.getZjCj() %}
                                    <th>{{valor}}</th>
                                {% endfor %}
                                <th colspan="2">
                                    Z={{ mat.getZ() }}
                                </th>
                            </tr>
                        </tbody>
                    </table>
                    {% endfor %}
                </div>
                <ul class="puntos">
                    {% for mat in objMat1 %}
                        <li class="punto-fase2"></li>
                    {%endfor%}    
                </ul>
            </div> -->
            
        </div>
        <div class="info-page">
            <h3 class="form-title">Resultado</h3>
        </div>
    </div>
</div>
<script>
    $('.carousel').carousel()
    function convert(){
        if(document.getElementById('checkbox').checked){
            $(".values").each(function(){
                if ( $(this).text() % 1 != 0) {
                    var result = toFraction($(this).text());
                    $(this).text(result[0]+'/'+result[1]);
                }
            });
        }else{
            $(".values").each(function(){
                if ( $(this).text() % 1 != 0) {
                    $(this).text(toDecimal($(this).text()));
                }
            });
        }
    }

    var toFraction = function (dec) {
        var is_neg = dec < 0;
        dec = Math.abs(dec);
        var done = false;
        //you can adjust the epsilon to a larger number if you don't need very high precision
        var n1 = 0, d1 = 1, n2 = 1, d2 = 0, n = 0, q = dec, epsilon = 1e-13;
        while (!done) {
            n++;
            if (n > 10000) {
                done = true;
            }
            var a = parseInt(q);
            var num = n1 + a * n2;
            var den = d1 + a * d2;
            var e = (q - a);
            if (e < epsilon) {
                done = true;
            }
            q = 1 / e;
            n1 = n2;
            d1 = d2;
            n2 = num;
            d2 = den;
            if (Math.abs(num / den - dec) < epsilon || n > 30) {
                done = true;
            }
        }
        return [is_neg ? -num : num, den];
    };

    function toDecimal(frac){
        let total = frac;
        if (frac.search("/") != -1){
            const numbers = frac.split("/");
            total = parseFloat(numbers[0]) / parseFloat(numbers[1]);
        }
        return total
    }
    
    window.addEventListener("beforeunload", async function(event){
        var direccion = '{{nom}}';
        var partes = direccion.split('/');
        var url = "http://127.0.0.1:5000/delete";
        let image={image:partes[partes.length-1]}
        await fetch(url,{
            method:'POST',
            body:JSON.stringify(image)
        });
    });
</script>
{% endblock %}